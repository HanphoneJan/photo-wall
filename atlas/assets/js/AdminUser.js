import{_ as e,r as a,u as s,c as l,B as t,M as n,a as u,o as r,e as i,w as o,k as c,s as d,i as v,j as m,p,a3 as f,F as y,D as w,b as g,t as h,E as b,a4 as _}from"./index.js";import{a as E,E as x}from"./interceptor.js";const C={class:"admin-user-container"},k={key:0,class:"table-layout"},z={key:1,class:"card-layout"},U={class:"user-card-content"},j={class:"user-info"},R={class:"info-item"},T={class:"info-value"},B={class:"info-item"},L={class:"info-value"},S={class:"info-item admin-status"},V={class:"info-value"},A={class:"user-actions"},D=e({__name:"AdminUser",setup(e){const D=a([]),G=a(""),W=s().username,F=a(1),H=a(10),I=a(0),M=a(window.innerWidth>=768),N=()=>{M.value=window.innerWidth>=768},q=async()=>{try{const{data:e}=await E.get(x.GETUSER);830===e.status?(D.value=e.data,I.value=e.data.length):b.error("获取用户信息失败！")}catch(e){b.error("请求出错！")}},J=l((()=>{if(!G.value)return D.value;const e=new RegExp(G.value,"i");return D.value.filter((a=>e.test(a.nickname)||e.test(a.username)))})),K=l((()=>{const e=(F.value-1)*H.value;return J.value.slice(e,e+H.value)})),O=()=>{F.value=1,J.value=D.value.filter((e=>e.username.includes(G.value)))},P=e=>{F.value=e},Q=async(e,a)=>{const s=e.type;e.type=a;try{const{data:a}=await E.post(x.CHANGEUSER,{user:e});830!==a.status?(e.type=s,b.error("修改用户类型失败")):b.success("修改用户类型成功")}catch(l){e.type=s,b.error("请求出错！")}},X=async e=>{try{await _.confirm("此操作将永久删除该用户, 是否继续","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0});const{data:a}=await E.post(x.DELETEUSER,{username:e});200!==a.code?b.error("删除用户失败！"):(b.success("删除用户成功！"),q())}catch(a){b.info("已取消删除")}};return t((()=>{q(),window.addEventListener("resize",N)})),n((()=>{window.removeEventListener("resize",N)})),(e,a)=>{const s=v("el-input"),l=v("el-col"),t=v("el-button"),n=v("el-row"),b=v("el-table-column"),_=v("el-switch"),E=v("el-table"),x=v("el-card"),D=v("el-pagination");return r(),u("div",C,[i(x,{shadow:"never"},{default:o((()=>[i(n,{gutter:5,class:"search-row"},{default:o((()=>[i(l,{xs:20,sm:8,md:6},{default:o((()=>[i(s,{placeholder:"请输入用户名",modelValue:G.value,"onUpdate:modelValue":a[0]||(a[0]=e=>G.value=e)},null,8,["modelValue"])])),_:1}),i(l,{xs:4,sm:3,md:2},{default:o((()=>[i(t,{type:"primary",onClick:O,class:"search-button"},{default:o((()=>a[1]||(a[1]=[m("查找用户")]))),_:1})])),_:1})])),_:1}),M.value?(r(),u("div",k,[i(E,{data:K.value,border:"",class:"user-table"},{default:o((()=>[i(b,{type:"index"}),i(b,{label:"用户名",prop:"username"}),i(b,{label:"邮箱",prop:"email","min-width":"100px"}),i(b,{label:"管理员","min-width":"70px"},{default:o((({row:e})=>[i(_,{"model-value":e.type,"active-value":"1","inactive-value":"0",disabled:e.username===p(W),onChange:a=>Q(e,a)},null,8,["model-value","disabled","onChange"])])),_:1}),i(b,{label:"操作"},{default:o((({row:e})=>[i(t,{size:"small",type:"danger",icon:p(f),onClick:a=>X(e.username)},null,8,["icon","onClick"])])),_:1})])),_:1},8,["data"])])):(r(),u("div",z,[i(n,{gutter:20},{default:o((()=>[(r(!0),u(y,null,w(K.value,(e=>(r(),c(l,{xs:24,sm:12,key:e.username},{default:o((()=>[i(x,{class:"user-card",shadow:"hover"},{default:o((()=>[g("div",U,[g("div",j,[g("div",R,[a[2]||(a[2]=g("span",{class:"info-label"},"用户名：",-1)),g("span",T,h(e.username),1)]),g("div",B,[a[3]||(a[3]=g("span",{class:"info-label"},"邮箱：",-1)),g("span",L,h(e.email),1)]),g("div",S,[a[4]||(a[4]=g("span",{class:"info-label"},"管理员：",-1)),g("span",V,[i(_,{"model-value":e.type,"active-value":"1","inactive-value":"0",disabled:e.username===p(W),onChange:a=>Q(e,a),size:"small"},null,8,["model-value","disabled","onChange"])])])]),g("div",A,[i(t,{type:"danger",icon:p(f),onClick:a=>X(e.username),size:"small"},{default:o((()=>a[5]||(a[5]=[m("删除")]))),_:2},1032,["icon","onClick"])])])])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),I.value>0?(r(),c(D,{key:2,"current-page":F.value,"page-size":H.value,total:I.value,layout:"total, prev, pager, next, jumper",onCurrentChange:P,class:"pagination-center"},null,8,["current-page","page-size","total"])):d("",!0)])),_:1})])}}},[["__scopeId","data-v-6f9257aa"]]);export{D as default};
