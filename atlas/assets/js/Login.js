import{g as e,d as r,u as a,r as o,c as t,a as l,b as s,e as n,w as u,T as i,n as d,f as c,h as p,v as f,i as m,o as g,t as v,j as h,k as b,E as y,l as w,_}from"./index.js";import{a as T,E as V}from"./interceptor.js";var C,k,x,B,S,q,U={exports:{}},A={exports:{}};function E(){return C||(C=1,e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r={rotl:function(e,r){return e<<r|e>>>32-r},rotr:function(e,r){return e<<32-r|e>>>r},endian:function(e){if(e.constructor==Number)return 16711935&r.rotl(e,8)|4278255360&r.rotl(e,24);for(var a=0;a<e.length;a++)e[a]=r.endian(e[a]);return e},randomBytes:function(e){for(var r=[];e>0;e--)r.push(Math.floor(256*Math.random()));return r},bytesToWords:function(e){for(var r=[],a=0,o=0;a<e.length;a++,o+=8)r[o>>>5]|=e[a]<<24-o%32;return r},wordsToBytes:function(e){for(var r=[],a=0;a<32*e.length;a+=8)r.push(e[a>>>5]>>>24-a%32&255);return r},bytesToHex:function(e){for(var r=[],a=0;a<e.length;a++)r.push((e[a]>>>4).toString(16)),r.push((15&e[a]).toString(16));return r.join("")},hexToBytes:function(e){for(var r=[],a=0;a<e.length;a+=2)r.push(parseInt(e.substr(a,2),16));return r},bytesToBase64:function(r){for(var a=[],o=0;o<r.length;o+=3)for(var t=r[o]<<16|r[o+1]<<8|r[o+2],l=0;l<4;l++)8*o+6*l<=8*r.length?a.push(e.charAt(t>>>6*(3-l)&63)):a.push("=");return a.join("")},base64ToBytes:function(r){r=r.replace(/[^A-Z0-9+\/]/gi,"");for(var a=[],o=0,t=0;o<r.length;t=++o%4)0!=t&&a.push((e.indexOf(r.charAt(o-1))&Math.pow(2,-2*t+8)-1)<<2*t|e.indexOf(r.charAt(o))>>>6-2*t);return a}},A.exports=r),A.exports;var e,r}function I(){if(x)return k;x=1;var e={utf8:{stringToBytes:function(r){return e.bin.stringToBytes(unescape(encodeURIComponent(r)))},bytesToString:function(r){return decodeURIComponent(escape(e.bin.bytesToString(r)))}},bin:{stringToBytes:function(e){for(var r=[],a=0;a<e.length;a++)r.push(255&e.charCodeAt(a));return r},bytesToString:function(e){for(var r=[],a=0;a<e.length;a++)r.push(String.fromCharCode(e[a]));return r.join("")}}};return k=e}
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */function j(){if(S)return B;function e(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}return S=1,B=function(r){return null!=r&&(e(r)||function(r){return"function"==typeof r.readFloatLE&&"function"==typeof r.slice&&e(r.slice(0,0))}(r)||!!r._isBuffer)}}var M=(q||(q=1,function(){var e=E(),r=I().utf8,a=j(),o=I().bin,t=function(l,s){l.constructor==String?l=s&&"binary"===s.encoding?o.stringToBytes(l):r.stringToBytes(l):a(l)?l=Array.prototype.slice.call(l,0):Array.isArray(l)||l.constructor===Uint8Array||(l=l.toString());for(var n=e.bytesToWords(l),u=8*l.length,i=1732584193,d=-271733879,c=-1732584194,p=271733878,f=0;f<n.length;f++)n[f]=16711935&(n[f]<<8|n[f]>>>24)|4278255360&(n[f]<<24|n[f]>>>8);n[u>>>5]|=128<<u%32,n[14+(u+64>>>9<<4)]=u;var m=t._ff,g=t._gg,v=t._hh,h=t._ii;for(f=0;f<n.length;f+=16){var b=i,y=d,w=c,_=p;i=m(i,d,c,p,n[f+0],7,-680876936),p=m(p,i,d,c,n[f+1],12,-389564586),c=m(c,p,i,d,n[f+2],17,606105819),d=m(d,c,p,i,n[f+3],22,-1044525330),i=m(i,d,c,p,n[f+4],7,-176418897),p=m(p,i,d,c,n[f+5],12,1200080426),c=m(c,p,i,d,n[f+6],17,-1473231341),d=m(d,c,p,i,n[f+7],22,-45705983),i=m(i,d,c,p,n[f+8],7,1770035416),p=m(p,i,d,c,n[f+9],12,-1958414417),c=m(c,p,i,d,n[f+10],17,-42063),d=m(d,c,p,i,n[f+11],22,-1990404162),i=m(i,d,c,p,n[f+12],7,1804603682),p=m(p,i,d,c,n[f+13],12,-40341101),c=m(c,p,i,d,n[f+14],17,-1502002290),i=g(i,d=m(d,c,p,i,n[f+15],22,1236535329),c,p,n[f+1],5,-165796510),p=g(p,i,d,c,n[f+6],9,-1069501632),c=g(c,p,i,d,n[f+11],14,643717713),d=g(d,c,p,i,n[f+0],20,-373897302),i=g(i,d,c,p,n[f+5],5,-701558691),p=g(p,i,d,c,n[f+10],9,38016083),c=g(c,p,i,d,n[f+15],14,-660478335),d=g(d,c,p,i,n[f+4],20,-405537848),i=g(i,d,c,p,n[f+9],5,568446438),p=g(p,i,d,c,n[f+14],9,-1019803690),c=g(c,p,i,d,n[f+3],14,-187363961),d=g(d,c,p,i,n[f+8],20,1163531501),i=g(i,d,c,p,n[f+13],5,-1444681467),p=g(p,i,d,c,n[f+2],9,-51403784),c=g(c,p,i,d,n[f+7],14,1735328473),i=v(i,d=g(d,c,p,i,n[f+12],20,-1926607734),c,p,n[f+5],4,-378558),p=v(p,i,d,c,n[f+8],11,-2022574463),c=v(c,p,i,d,n[f+11],16,1839030562),d=v(d,c,p,i,n[f+14],23,-35309556),i=v(i,d,c,p,n[f+1],4,-1530992060),p=v(p,i,d,c,n[f+4],11,1272893353),c=v(c,p,i,d,n[f+7],16,-155497632),d=v(d,c,p,i,n[f+10],23,-1094730640),i=v(i,d,c,p,n[f+13],4,681279174),p=v(p,i,d,c,n[f+0],11,-358537222),c=v(c,p,i,d,n[f+3],16,-722521979),d=v(d,c,p,i,n[f+6],23,76029189),i=v(i,d,c,p,n[f+9],4,-640364487),p=v(p,i,d,c,n[f+12],11,-421815835),c=v(c,p,i,d,n[f+15],16,530742520),i=h(i,d=v(d,c,p,i,n[f+2],23,-995338651),c,p,n[f+0],6,-198630844),p=h(p,i,d,c,n[f+7],10,1126891415),c=h(c,p,i,d,n[f+14],15,-1416354905),d=h(d,c,p,i,n[f+5],21,-57434055),i=h(i,d,c,p,n[f+12],6,1700485571),p=h(p,i,d,c,n[f+3],10,-1894986606),c=h(c,p,i,d,n[f+10],15,-1051523),d=h(d,c,p,i,n[f+1],21,-2054922799),i=h(i,d,c,p,n[f+8],6,1873313359),p=h(p,i,d,c,n[f+15],10,-30611744),c=h(c,p,i,d,n[f+6],15,-1560198380),d=h(d,c,p,i,n[f+13],21,1309151649),i=h(i,d,c,p,n[f+4],6,-145523070),p=h(p,i,d,c,n[f+11],10,-1120210379),c=h(c,p,i,d,n[f+2],15,718787259),d=h(d,c,p,i,n[f+9],21,-343485551),i=i+b>>>0,d=d+y>>>0,c=c+w>>>0,p=p+_>>>0}return e.endian([i,d,c,p])};t._ff=function(e,r,a,o,t,l,s){var n=e+(r&a|~r&o)+(t>>>0)+s;return(n<<l|n>>>32-l)+r},t._gg=function(e,r,a,o,t,l,s){var n=e+(r&o|a&~o)+(t>>>0)+s;return(n<<l|n>>>32-l)+r},t._hh=function(e,r,a,o,t,l,s){var n=e+(r^a^o)+(t>>>0)+s;return(n<<l|n>>>32-l)+r},t._ii=function(e,r,a,o,t,l,s){var n=e+(a^(r|~o))+(t>>>0)+s;return(n<<l|n>>>32-l)+r},t._blocksize=16,t._digestsize=16,U.exports=function(r,a){if(null==r)throw new Error("Illegal argument "+r);var l=e.wordsToBytes(t(r,a));return a&&a.asBytes?l:a&&a.asString?o.bytesToString(l):e.bytesToHex(l)}}()),U.exports);const R=e(M),P={class:"login-wrapper"},L={class:"login-container"},O={class:"form sign-in"},N={id:"captchaQuestion",style:{color:"black"}},W={class:"buttonWrapper"},F={class:"forgot-pass"},z={class:"img"},D={class:"imgText m-up"},G={class:"imgText m-in"},H={class:"imgBtn"},Q={class:"form sign-up"},Z={class:"buttonWrapper"},$=_(r({__name:"Login",setup(e){const r=a(),_=w(),C=o({username:"",password:"",captcha:""}),k=o({username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],captcha:[{required:!0,message:"请输入验证码",trigger:"blur"}]}),x=o(null),B=o({username:"",password:"",confirmPassword:"",email:"",emailCode:""}),S=o(!1),q=()=>(S.value=!S.value,{isSignup:S,toggleSignup:q}),U=t((()=>({}))),A=()=>{const e=Math.floor(10*Math.random())+10,r=Math.floor(10*Math.random())+10;return{question:`${e} + ${r}`,answer:e+r}},E=o(A()),I=o(E.value.question),j=()=>{x.value.validate((e=>{if(!e)return y.error("请正确填写信息"),!1;{if(parseInt(C.value.captcha)!==E.value.answer)return y.error("验证码错误"),E.value=A(),void(I.value=E.value.question);const e=R(C.value.password);T.post(V.LOGIN,{user:{username:C.value.username,password:e,loginProvince:"",loginCity:"",loginLat:30.27,loginLng:103.08}},{headers:{"Content-Type":"application/json"}}).then((e=>{if(200===e.data.code){const{user:a,token:o,expire:t}=e.data.data;r.login(a,o,t),y.success("登录成功"),_.push("/")}else y.error("登录失败，账号或密码错误"),console.log(e.data)})).catch((e=>{y.error("登录失败"),console.error("登录出错",e.message)}))}}))},M=o(null),$={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(e,r,a)=>{r!==B.value.password?a(new Error("两次输入的密码不一致")):a()},trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],emailCode:[{required:!0,message:"请输入邮箱验证码",trigger:"blur"}]},J=o(!1),K=o(null),X=()=>{J.value?y.warning("请稍后再试"):(J.value=!0,T.post(V.SENDVERICATIONCODE,{email:B.value.email}).then((e=>{830===e.data.status?(y.success("验证码已发送"),Y()):(y.error("发送验证码失败"),J.value=!1)})).catch((e=>{y.error("发送验证码失败"),console.error("发送验证码出错",e.message),J.value=!1})))},Y=()=>{K.value=setTimeout((()=>{J.value=!1}),6e4)},ee=()=>{M.value.validate((e=>{if(!e)return y.error("请正确填写信息"),!1;{const e=R(B.value.password);T.post(V.REGISTER,{username:B.value.username,password:e,email:B.value.email,code:B.value.emailCode},{withCredentials:!0}).then((e=>{830===e.data.status?(y.success("注册成功，自动跳转登录界面"),_.push("/login")):(y.error("注册失败"),console.log(e.data))})).catch((e=>{y.error("注册失败，存在异常")}))}}))},re=()=>{y.warning("暂不支持微信登录")},ae=()=>{y.warning("暂不支持微信注册")};return(e,r)=>{const a=m("el-input"),o=m("el-form-item"),t=m("el-form"),y=m("el-button"),w=m("router-link"),_=m("el-icon");return g(),l("div",P,[s("div",L,[n(i,{name:"slide-login",mode:"out-in"},{default:u((()=>[p(s("div",O,[r[12]||(r[12]=s("h2",{style:{color:"black"}},"欢迎回来",-1)),n(t,{model:C.value,rules:k.value,ref_key:"loginFormRef",ref:x,class:"form-content"},{default:u((()=>[n(o,{prop:"username",label:"用户名"},{default:u((()=>[n(a,{modelValue:C.value.username,"onUpdate:modelValue":r[0]||(r[0]=e=>C.value.username=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),n(o,{prop:"password",label:"密码"},{default:u((()=>[n(a,{modelValue:C.value.password,"onUpdate:modelValue":r[1]||(r[1]=e=>C.value.password=e),type:"password",autocomplete:"off","show-password":""},null,8,["modelValue"])])),_:1}),n(o,{label:"验证码",prop:"captcha"},{default:u((()=>[s("div",N,"请计算："+v(I.value),1),n(a,{modelValue:C.value.captcha,"onUpdate:modelValue":r[2]||(r[2]=e=>C.value.captcha=e),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"]),s("div",W,[n(y,{type:"primary",class:"submit",onClick:j},{default:u((()=>r[8]||(r[8]=[h("登 录")]))),_:1}),n(y,{type:"success",class:"wechat-btn",onClick:re},{default:u((()=>r[9]||(r[9]=[h("使用 "),s("span",null,"微信",-1),h(" 帐号登录")]))),_:1})]),s("p",F,[n(w,{to:"/",style:{"margin-right":"14px"}},{default:u((()=>r[10]||(r[10]=[h("返回主页")]))),_:1}),n(w,{to:"/forgotpassword"},{default:u((()=>r[11]||(r[11]=[h(" 忘记密码？")]))),_:1})])],512),[[f,!S.value]])])),_:1}),s("div",{style:c(U.value),class:d(["sub-content",{hidden:S.value}])},[s("div",z,[p(s("div",D,r[13]||(r[13]=[s("h3",null,"还未注册？",-1),s("p",null,"立即注册！",-1)]),512),[[f,!S.value]]),p(s("div",G,r[14]||(r[14]=[s("h3",null,"已有帐号？",-1),s("p",null,"有帐号就登录吧, ",-1),s("p",null," 好久不见了！",-1)]),512),[[f,S.value]]),s("div",H,[n(y,{type:"primary",onClick:q,style:{"background-color":"#f08c4e"},id:"img_btn"},{default:u((()=>[S.value?(g(),b(_,{key:1},{default:u((()=>r[16]||(r[16]=[h(" 登录 ")]))),_:1})):(g(),b(_,{key:0},{default:u((()=>r[15]||(r[15]=[h("注册 ")]))),_:1}))])),_:1})])])],6),n(i,{name:"slide-register",mode:"out-in"},{default:u((()=>[p(s("div",Q,[r[20]||(r[20]=s("h2",null,"立即注册",-1)),n(t,{model:B.value,rules:$,ref_key:"registerFormRef",ref:M,class:"form-content"},{default:u((()=>[n(o,{prop:"username",label:"用户名"},{default:u((()=>[n(a,{modelValue:B.value.username,"onUpdate:modelValue":r[3]||(r[3]=e=>B.value.username=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),n(o,{prop:"email",label:"邮箱"},{default:u((()=>[n(a,{modelValue:B.value.email,"onUpdate:modelValue":r[4]||(r[4]=e=>B.value.email=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),n(o,{prop:"password",label:"密码"},{default:u((()=>[n(a,{modelValue:B.value.password,"onUpdate:modelValue":r[5]||(r[5]=e=>B.value.password=e),type:"password",autocomplete:"off","show-password":""},null,8,["modelValue"])])),_:1}),n(o,{label:"确认密码",prop:"confirmPassword"},{default:u((()=>[n(a,{type:"password",modelValue:B.value.confirmPassword,"onUpdate:modelValue":r[6]||(r[6]=e=>B.value.confirmPassword=e),autocomplete:"off","show-password":""},null,8,["modelValue"])])),_:1}),n(o,{label:"邮箱验证码",prop:"emailCode"},{default:u((()=>[n(a,{modelValue:B.value.emailCode,"onUpdate:modelValue":r[7]||(r[7]=e=>B.value.emailCode=e),autocomplete:"off"},null,8,["modelValue"]),n(y,{onClick:X,disabled:J.value,id:"emailCode"},{default:u((()=>r[17]||(r[17]=[h("发送验证码")]))),_:1},8,["disabled"])])),_:1})])),_:1},8,["model"]),s("div",Z,[n(y,{type:"primary",class:"submit",onClick:ee},{default:u((()=>r[18]||(r[18]=[h("注 册")]))),_:1}),n(y,{type:"success",class:"wechat-btn",onClick:ae},{default:u((()=>r[19]||(r[19]=[h("使用 "),s("span",null,"微信",-1),h(" 帐号注册")]))),_:1})])],512),[[f,S.value]])])),_:1})])])}}}),[["__scopeId","data-v-4536be63"]]);export{$ as default};
