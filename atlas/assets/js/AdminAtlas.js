import{d as e,u as a,r as l,B as t,M as s,a as o,e as i,b as n,w as u,i as r,o as d,k as c,F as p,D as m,j as v,t as f,a5 as y,a6 as w,E as b,a4 as V,_ as g}from"./index.js";import{a as h,E as _}from"./interceptor.js";const k={class:"admin-atlas-container"},C={key:0,class:"table-layout"},z={class:"table-container"},T={class:"btn-group"},x={key:1,class:"card-layout"},E={class:"card-header"},U={class:"card-title"},A={class:"card-image-container"},B={class:"card-content"},I={class:"card-info"},D={class:"info-item"},N={class:"info-value"},O={class:"info-item"},H={class:"info-value"},P={class:"info-item"},K={class:"info-value"},L={class:"info-item"},j={class:"info-value status-value"},G={class:"card-description"},M={class:"description-text"},W={class:"card-tags"},$={class:"tags-container"},F={class:"card-actions"},S=g(e({__name:"AdminAtlas",setup(e){const g=a(),S=l([]),Y=l(!1),q=l(null),J=l(null),Q=l(window.innerWidth>=768),R=()=>{Q.value=window.innerWidth>=768};t((async()=>{try{const e=await h.get(_.ADMINSHOW,{});200===e.status?S.value=e.data.data.map((e=>({...e,type:Number(e.type),inputVisible:!1,inputValue:""}))):console.error("错误的数据结构:",e.data)}catch(e){console.error("获取图集数据失败:",e.message)}window.addEventListener("resize",R)})),s((()=>{window.removeEventListener("resize",R)}));const X=e=>{e.inputVisible=!0,w((()=>{J.value&&J.value.focus()}))},Z=async e=>{if(!e.inputValue)return e.inputValue="",void(e.inputVisible=!1);const a=e.inputValue.trim();if(""!==a){e.tags.push({id:Date.now(),name:a});try{const l=await h.post(_.ADDTAG,{filesId:e.id,tagName:a});e.inputValue="",e.inputVisible=!1,830===l.data.status?b.success("标签添加成功"):(e.tags.pop(),b.error("标签添加失败"))}catch(l){e.inputValue="",e.inputVisible=!1,e.tags.pop(),b.error("请求失败")}}},ee=async(e,a)=>{try{if("confirm"===await V.confirm("此操作将永久删除该标签, 是否继续","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})){const l=a.tags[e];830===(await h.post(_.DELETEPHOTOTAG,{filesId:a.id,tagId:l.id})).data.status?(a.tags.splice(e,1),b.success("标签删除成功")):b.error("标签删除失败")}else b.success("已取消删除")}catch(l){"cancel"!==l&&"close"!==l&&(console.error("删除标签失败：",l.message),b.error("删除失败"))}},ae=async(e,a)=>{const l=e.type;e.type=Number(a);try{const{data:a}=await h.post(_.CHANGEPHOTOTYPE,{photo:e});830!==a.status?(e.type=l,b.error("审核失败")):b.success("审核成功")}catch(t){e.type=l,b.error("请求出错！服务器繁忙，请稍后再试。")}},le=(e,a)=>Number(e.likes)-Number(a.likes),te=(e,a)=>e.type-a.type,se=async e=>{q.value={...e},Y.value=!0,await w()},oe=async()=>{if(q.value)try{const e={...q.value,type:Number(q.value.type)},a=await h.post(_.ADMINUPDATE,e,{headers:{Authorization:`Bearer ${g.token}`}});if(830===a.data.status){const a=S.value.findIndex((e=>e.id===q.value.id));-1!==a&&(S.value[a]={...e}),Y.value=!1,b.success("更新成功")}else console.error("图片数据更新失败:",a.data.message),b.error("更新失败")}catch(e){console.error("图片数据更新出错:",e.message),b.error("更新失败")}},ie=async e=>{try{if("confirm"===await V.confirm("此操作将永久删除该照片, 是否继续","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})){const a=await h.post(_.DELETEPHOTO,{fileId:e.id},{headers:{Authorization:`Bearer ${g.token}`}});830===a.data.status?(S.value=S.value.filter((a=>a.id!==e.id)),b.success("删除成功")):(console.error("删除图片失败:",a.data.message),b.error("删除失败"))}else b.info("已取消删除")}catch(a){"cancel"!==a&&"close"!==a&&(console.error("删除失败:",a.message),b.error("删除失败"))}};return(e,a)=>{const l=r("el-image"),t=r("el-table-column"),s=r("el-switch"),w=r("el-tag"),b=r("el-input"),V=r("el-button"),g=r("el-table"),h=r("el-card"),_=r("el-col"),R=r("el-row"),ne=r("el-form-item"),ue=r("el-form"),re=r("el-dialog");return d(),o("div",k,[Q.value?(d(),o("div",C,[n("div",z,[i(g,{data:S.value,class:"responsive-table"},{default:u((()=>[i(t,{label:"图片"},{default:u((e=>[i(l,{src:e.row.path,class:"image-preview","preview-src-list":[e.row.path],"preview-teleported":""},null,8,["src","preview-src-list"])])),_:1}),i(t,{prop:"author",label:"作者",width:"90px",sortable:""}),i(t,{prop:"title",label:"标题"}),i(t,{prop:"description",label:"简介"}),i(t,{prop:"upload_time",label:"上传时间",sortable:""}),i(t,{prop:"likes",label:"点赞数",width:"100px",sortable:!0,"sort-method":le}),i(t,{label:"审核状态",width:"110px",sortable:!0,"sort-method":te},{default:u((({row:e})=>[i(s,{"model-value":e.type,"active-value":1,"inactive-value":0,onChange:a=>ae(e,a)},null,8,["model-value","onChange"])])),_:1}),i(t,{label:"标签",prop:"tags"},{default:u((e=>[(d(!0),o(p,null,m(e.row.tags,((a,l)=>(d(),c(w,{size:"default",key:a.id,closable:"",onClose:a=>ee(l,e.row)},{default:u((()=>[v(f(a.name),1)])),_:2},1032,["onClose"])))),128)),e.row.inputVisible?(d(),c(b,{key:0,size:"small",style:{width:"100px"},class:"input-new-tag",modelValue:e.row.inputValue,"onUpdate:modelValue":a=>e.row.inputValue=a,ref_key:"saveTagInput",ref:J,onKeyup:y((a=>Z(e.row)),["enter"]),onBlur:a=>Z(e.row)},null,8,["modelValue","onUpdate:modelValue","onKeyup","onBlur"])):(d(),c(V,{key:1,size:"small",class:"button-new-tag",onClick:a=>X(e.row)},{default:u((()=>a[8]||(a[8]=[v(" + 新标签 ")]))),_:2},1032,["onClick"]))])),_:1}),i(t,{label:"操作"},{default:u((e=>[n("div",T,[i(V,{onClick:a=>se(e.row),type:"primary",size:"small"},{default:u((()=>a[9]||(a[9]=[v("编辑")]))),_:2},1032,["onClick"]),i(V,{onClick:a=>ie(e.row),type:"danger",size:"small"},{default:u((()=>a[10]||(a[10]=[v("删除")]))),_:2},1032,["onClick"])])])),_:1})])),_:1},8,["data"])])])):(d(),o("div",x,[i(R,{gutter:20},{default:u((()=>[(d(!0),o(p,null,m(S.value,(e=>(d(),c(_,{xs:24,sm:12,md:8,key:e.id},{default:u((()=>[i(h,{class:"atlas-card",shadow:"hover"},{header:u((()=>[n("div",E,[n("h3",U,f(e.title),1)])])),default:u((()=>[n("div",A,[i(l,{src:e.path,class:"card-image","preview-src-list":[e.path],"preview-teleported":""},null,8,["src","preview-src-list"])]),n("div",B,[n("div",I,[n("div",D,[a[11]||(a[11]=n("span",{class:"info-label"},"作者：",-1)),n("span",N,f(e.author),1)]),n("div",O,[a[12]||(a[12]=n("span",{class:"info-label"},"上传时间：",-1)),n("span",H,f(e.upload_time),1)]),n("div",P,[a[13]||(a[13]=n("span",{class:"info-label"},"点赞数：",-1)),n("span",K,f(e.likes),1)]),n("div",L,[a[14]||(a[14]=n("span",{class:"info-label"},"审核状态：",-1)),n("span",j,[i(s,{"model-value":e.type,"active-value":1,"inactive-value":0,onChange:a=>ae(e,a),size:"small"},null,8,["model-value","onChange"])])])]),n("div",G,[a[15]||(a[15]=n("span",{class:"info-label"},"简介：",-1)),n("p",M,f(e.description),1)]),n("div",W,[a[17]||(a[17]=n("span",{class:"info-label"},"标签：",-1)),n("div",$,[(d(!0),o(p,null,m(e.tags,((a,l)=>(d(),c(w,{size:"small",key:a.id,closable:"",onClose:a=>ee(l,e)},{default:u((()=>[v(f(a.name),1)])),_:2},1032,["onClose"])))),128)),e.inputVisible?(d(),c(b,{key:0,size:"small",style:{width:"100px"},class:"input-new-tag",modelValue:e.inputValue,"onUpdate:modelValue":a=>e.inputValue=a,ref_for:!0,ref_key:"saveTagInput",ref:J,onKeyup:y((a=>Z(e)),["enter"]),onBlur:a=>Z(e)},null,8,["modelValue","onUpdate:modelValue","onKeyup","onBlur"])):(d(),c(V,{key:1,size:"small",class:"button-new-tag",onClick:a=>X(e)},{default:u((()=>a[16]||(a[16]=[v(" + 新标签 ")]))),_:2},1032,["onClick"]))])])]),n("div",F,[i(V,{onClick:a=>se(e),type:"primary",size:"small"},{default:u((()=>a[18]||(a[18]=[v("编辑")]))),_:2},1032,["onClick"]),i(V,{onClick:a=>ie(e),type:"danger",size:"small"},{default:u((()=>a[19]||(a[19]=[v("删除")]))),_:2},1032,["onClick"])])])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),i(re,{modelValue:Y.value,"onUpdate:modelValue":a[7]||(a[7]=e=>Y.value=e),title:"编辑图集项","destroy-on-close":""},{footer:u((()=>[i(V,{onClick:a[6]||(a[6]=e=>Y.value=!1)},{default:u((()=>a[20]||(a[20]=[v("取消")]))),_:1}),i(V,{type:"primary",onClick:oe},{default:u((()=>a[21]||(a[21]=[v("保存")]))),_:1})])),default:u((()=>[i(ue,{model:q.value},{default:u((()=>[i(ne,{label:"作者"},{default:u((()=>[i(b,{modelValue:q.value.author,"onUpdate:modelValue":a[0]||(a[0]=e=>q.value.author=e)},null,8,["modelValue"])])),_:1}),i(ne,{label:"标题"},{default:u((()=>[i(b,{modelValue:q.value.title,"onUpdate:modelValue":a[1]||(a[1]=e=>q.value.title=e)},null,8,["modelValue"])])),_:1}),i(ne,{label:"简介"},{default:u((()=>[i(b,{modelValue:q.value.description,"onUpdate:modelValue":a[2]||(a[2]=e=>q.value.description=e)},null,8,["modelValue"])])),_:1}),i(ne,{label:"点赞量"},{default:u((()=>[i(b,{modelValue:q.value.likes,"onUpdate:modelValue":a[3]||(a[3]=e=>q.value.likes=e)},null,8,["modelValue"])])),_:1}),i(ne,{label:"审核状态"},{default:u((()=>[i(s,{modelValue:q.value.type,"onUpdate:modelValue":a[4]||(a[4]=e=>q.value.type=e),"active-value":1,"inactive-value":0},null,8,["modelValue"])])),_:1}),i(ne,{label:"用户名"},{default:u((()=>[i(b,{modelValue:q.value.username,"onUpdate:modelValue":a[5]||(a[5]=e=>q.value.username=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-5853f49c"]]);export{S as default};
