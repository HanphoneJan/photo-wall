import{d as e,r as a,B as s,C as t,c as l,m as o,a as i,e as c,b as n,w as d,T as r,F as u,D as m,o as h,G as p,i as y,s as v,j as g,t as w,p as f,H as k,k as b,I as _,J as C,K as E,L,_ as x}from"./index.js";import{a as j,E as z}from"./interceptor.js";const I={key:"welcome-page",class:"welcome-container"},T={class:"tit"},G={class:"intro"},H={class:"atlas-container",id:"atlas-container"},N={class:"masonry-columns"},S={class:"photo-wrapper"},W={class:"photo-overlay"},A={class:"photo-info-overlay"},F={class:"title-author-row"},K={class:"photo-title"},R={class:"photo-author"},$={class:"photo-description"},q={class:"tags-actions-row"},B={class:"photo-tags"},D={class:"photo-actions"},J={class:"likes-count"},O=x(e({__name:"Atlas",setup(e){const x=p(),O=a([]),P=a([]),U=a([]),M=a([]),Q=a(!0);let V;a([]);const X=a("生活の瞬間を捉え、感動を記録する"),Y=a("寒楓のフォトギャラリー");s((async()=>{(new Image).src="https://hanphone.top/blog/atlas/background.jpeg",le(),te(),se()})),t((()=>x.query.tags),(e=>{M.value=e?e.split(",").map((e=>Number(e))):[]}),{immediate:!0});const Z=l((()=>{const e=M.value.map((e=>Number(e)));if(0===e.length)return U.value;return U.value.filter((a=>e.every((e=>a.tags.some((a=>null!==a.id&&Number(a.id)===e))))))})),ee=()=>{Q.value=!1},ae=()=>{clearTimeout(V),ee()},se=()=>{V=setTimeout((()=>{ee()}),3e3)},te=async()=>{try{const e=await j.get(z.SHOW);830===e.data.status&&(P.value=e.data.data,U.value=[...P.value].sort(((e,a)=>a.likes-e.likes)))}catch(e){console.error("获取图集数据失败：",e.message)}},le=async()=>{try{const e=await j.get(z.GETTAG);830===e.data.status&&(O.value=e.data.data)}catch(e){console.error("获取标签列表失败:",e.message)}};return o((()=>{const e=()=>{window.innerWidth<768?(Y.value="寒楓の照片墙",X.value="生活の瞬間を捉え"):Y.value="寒楓のフォトギャラリー"};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}})),(e,a)=>{const s=y("el-icon"),t=y("el-card"),l=y("el-col"),o=y("el-row"),p=y("el-image"),x=y("el-tag");return h(),i(u,null,[c(r,{name:"slide-left",mode:"out-in"},{default:d((()=>[Q.value?(h(),i("div",I,[c(o,{style:{height:"100vh"},class:"welcome-row"},{default:d((()=>[c(l,{span:24,style:{height:"100%"}},{default:d((()=>[c(t,{shadow:"hover",class:"welcome"},{default:d((()=>[n("h1",T,[g(w(Y.value)+" ",1),a[0]||(a[0]=n("div",{class:"border"},null,-1))]),n("h2",G,w(X.value),1),n("div",{class:"bounce down",onClick:ae},[c(s,{style:{color:"white"}},{default:d((()=>[c(f(k))])),_:1})])])),_:1})])),_:1})])),_:1})])):v("",!0)])),_:1}),n("div",H,[n("div",N,[(h(!0),i(u,null,m(Z.value,(e=>(h(),i("div",{key:e.id,class:"grid-item"},[c(t,{"body-style":{padding:"0px"},class:"photo-card"},{default:d((()=>[n("div",S,[c(p,{src:e.path,class:"image",lazy:"",ref_for:!0,ref:"imageRef"},null,8,["src"]),n("div",W,[n("div",A,[n("div",F,[n("div",K,w(e.title),1),n("div",R,"@"+w(e.author),1)]),n("div",$,w(e.description),1),n("div",q,[n("div",B,[(h(!0),i(u,null,m(e.tags,(e=>(h(),b(x,{key:e.id,size:"small",type:"info",class:"photo-tag"},{default:d((()=>[g(" #"+w(e.name),1)])),_:2},1024)))),128))]),n("div",D,[c(s,{class:"action-icon",onClick:a=>(e=>{const a=document.createElement("div");a.style.position="fixed",a.style.top="0",a.style.left="0",a.style.width="100%",a.style.height="100%",a.style.backgroundColor="rgba(0, 0, 0, 0.8)",a.style.display="flex",a.style.justifyContent="center",a.style.alignItems="center",a.style.zIndex="9999",a.style.cursor="zoom-out";const s=document.createElement("img");s.src=e.path,s.style.maxWidth="90%",s.style.maxHeight="90%",s.style.objectFit="contain",a.appendChild(s),document.body.appendChild(a),a.addEventListener("click",(()=>{document.body.removeChild(a)}))})(e)},{default:d((()=>[c(f(_),{style:{color:"white"}})])),_:2},1032,["onClick"]),c(s,{class:"action-icon",onClick:a=>(e=>{const a=new URL(e.path);a.searchParams.append("download","1");const s=document.createElement("a");s.target="_blank",s.href=a.toString(),s.download=`${e.title}_${e.author}.jpg`,document.body.appendChild(s),s.click(),setTimeout((()=>{document.body.removeChild(s)}),0)})(e)},{default:d((()=>[c(f(C),{style:{color:"white"}})])),_:2},1032,["onClick"]),c(s,{class:"action-icon",onClick:a=>(e=>{e.isLiked||j.post(z.LIKES,{id:e.id}).then((a=>{830===a.data.status?(e.isLiked=!0,e.likes++,console.log(a.data.message)):console.error("点赞失败:",a.data.message)})).catch((e=>{console.error("点赞失败:",e.message)}))})(e)},{default:d((()=>[e.isLiked?(h(),b(f(E),{key:0,style:{color:"yellow"}})):(h(),b(f(L),{key:1,style:{color:"white"}}))])),_:2},1032,["onClick"]),n("span",J,w(e.likes),1)])])])])])])),_:2},1024)])))),128))])])],64)}}}),[["__scopeId","data-v-506b1dcf"]]);export{O as default};
